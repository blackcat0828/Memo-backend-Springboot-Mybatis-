<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org/DTD Mapper 3.0//EN"
		"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
		
<mapper namespace="com.jeffworld.memo.mapper.PersonalMemoMapper">
	
	<!-- 개인 메모 rsultMap -->
	<resultMap type="com.jeffworld.memo.dto.PersonalBoard" id="boardMap">
		<result property="pboardid" column="pboardid" />
		<result property="title" column="title" />
		<result property="owner" column="owner" />
	</resultMap>

	<resultMap type="com.jeffworld.memo.dto.PersonalMemo" id="memoMap">
		<result property="id" column="id" />
		<result property="title" column="title" />
		<result property="contents" column="contents" />
		<result property="boardId" column="boardId" />
	</resultMap>
	
	<select id="findPersonalBoardByEmail" resultMap="boardMap">
		SELECT pboardid, title, owner from personalBoard where owner = #{email};
	</select>
	
	<insert id="addPersonalBoard">
		INSERT into personalBoard(title, owner) values(#{title}, #{owner})
		<!-- LAST_INSERT_ID가 추가된 object를 반환 -->
		<selectKey resultType="int" keyProperty="pboardid" order="AFTER">
        	SELECT LAST_INSERT_ID()
    	</selectKey>   
	</insert>
	
	<update id="updatePersonalBoard">
		update personalBoard set title = #{title} where pboardid = #{pboardid}
	</update>
	
	<delete id="deletePersonalBoard">
		delete from personalBoard where pboardid = #{pboardid}
	</delete>
	
	<select id="getPersonalMemosLength" resultType="int">
		SELECT count(id) from personalMemo where boardId = #{pboardid}
	</select>
	
	<select id="getPersonalMemos" parameterType="int" resultType="com.jeffworld.memo.dto.PersonalMemo">
		select * from personalMemo where boardId = #{pboardid} order by id desc limit #{currentPage}, #{perPage};
	</select>
	
	<select id="getPersonalMemosLengthWithTitle" parameterType="map" resultType="int">
		SELECT count(id) from personalMemo where boardId = #{pboardid} and title Like '%' #{title} '%'
	</select>
	
	<select id="getPersonalMemosWithTitle"  resultType="com.jeffworld.memo.dto.PersonalMemo">
		select * from personalMemo where boardId = #{pboardid} and title Like '%' #{title} '%' order by id desc limit #{currentPage}, #{perPage};
	</select>
	
	
	<insert id="addPersonalMemo">
		INSERT into personalMemo(title, contents, boardId) values(#{title}, #{contents}, #{boardId})
		<!-- LAST_INSERT_ID가 추가된 object를 반환 --> 
	</insert>
	
	<update id="updatePersonalMemo">
		update personalMemo set title = #{title}, contents = #{contents} where id = #{id}
	</update>
	
	<delete id="deletePersonalMemo">
		delete from personalMemo where id = #{memoId}
	</delete>
	
	<select id="getPersonalMemo" resultType="com.jeffworld.memo.dto.PersonalMemo">
		SELECT * from personalMemo where id = #{memoId}
	</select>
	
</mapper>